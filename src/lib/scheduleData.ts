export type TaskType = 'Main Hall' | 'CR'

export interface CleaningAssignment {
  date: string
  group: number
  taskType: TaskType
}

export const cleaningSchedule2026: CleaningAssignment[] = [
  { date: '2026-01-03', group: 1, taskType: 'Main Hall' },
  { date: '2026-01-03', group: 2, taskType: 'CR' },
  { date: '2026-01-10', group: 3, taskType: 'Main Hall' },
  { date: '2026-01-10', group: 4, taskType: 'CR' },
  { date: '2026-01-17', group: 5, taskType: 'Main Hall' },
  { date: '2026-01-17', group: 6, taskType: 'CR' },
  { date: '2026-01-24', group: 1, taskType: 'CR' },
  { date: '2026-01-24', group: 2, taskType: 'Main Hall' },
  { date: '2026-01-31', group: 3, taskType: 'CR' },
  { date: '2026-01-31', group: 4, taskType: 'Main Hall' },
  
  { date: '2026-02-07', group: 5, taskType: 'CR' },
  { date: '2026-02-07', group: 6, taskType: 'Main Hall' },
  { date: '2026-02-14', group: 1, taskType: 'Main Hall' },
  { date: '2026-02-14', group: 2, taskType: 'CR' },
  { date: '2026-02-21', group: 3, taskType: 'Main Hall' },
  { date: '2026-02-21', group: 4, taskType: 'CR' },
  { date: '2026-02-28', group: 5, taskType: 'Main Hall' },
  { date: '2026-02-28', group: 6, taskType: 'CR' },
  
  { date: '2026-03-07', group: 1, taskType: 'CR' },
  { date: '2026-03-07', group: 2, taskType: 'Main Hall' },
  { date: '2026-03-14', group: 3, taskType: 'CR' },
  { date: '2026-03-14', group: 4, taskType: 'Main Hall' },
  { date: '2026-03-21', group: 5, taskType: 'CR' },
  { date: '2026-03-21', group: 6, taskType: 'Main Hall' },
  { date: '2026-03-28', group: 1, taskType: 'Main Hall' },
  { date: '2026-03-28', group: 2, taskType: 'CR' },
  
  { date: '2026-04-04', group: 3, taskType: 'Main Hall' },
  { date: '2026-04-04', group: 4, taskType: 'CR' },
  { date: '2026-04-11', group: 5, taskType: 'Main Hall' },
  { date: '2026-04-11', group: 6, taskType: 'CR' },
  { date: '2026-04-18', group: 1, taskType: 'CR' },
  { date: '2026-04-18', group: 2, taskType: 'Main Hall' },
  { date: '2026-04-25', group: 3, taskType: 'CR' },
  { date: '2026-04-25', group: 4, taskType: 'Main Hall' },
  
  { date: '2026-05-02', group: 5, taskType: 'CR' },
  { date: '2026-05-02', group: 6, taskType: 'Main Hall' },
  { date: '2026-05-09', group: 1, taskType: 'Main Hall' },
  { date: '2026-05-09', group: 2, taskType: 'CR' },
  { date: '2026-05-16', group: 3, taskType: 'Main Hall' },
  { date: '2026-05-16', group: 4, taskType: 'CR' },
  { date: '2026-05-23', group: 5, taskType: 'Main Hall' },
  { date: '2026-05-23', group: 6, taskType: 'CR' },
  { date: '2026-05-30', group: 1, taskType: 'CR' },
  { date: '2026-05-30', group: 2, taskType: 'Main Hall' },
  
  { date: '2026-06-06', group: 3, taskType: 'CR' },
  { date: '2026-06-06', group: 4, taskType: 'Main Hall' },
  { date: '2026-06-13', group: 5, taskType: 'CR' },
  { date: '2026-06-13', group: 6, taskType: 'Main Hall' },
  { date: '2026-06-20', group: 1, taskType: 'Main Hall' },
  { date: '2026-06-20', group: 2, taskType: 'CR' },
  { date: '2026-06-27', group: 3, taskType: 'Main Hall' },
  { date: '2026-06-27', group: 4, taskType: 'CR' },
  
  { date: '2026-07-04', group: 5, taskType: 'Main Hall' },
  { date: '2026-07-04', group: 6, taskType: 'CR' },
  { date: '2026-07-11', group: 1, taskType: 'CR' },
  { date: '2026-07-11', group: 2, taskType: 'Main Hall' },
  { date: '2026-07-18', group: 3, taskType: 'CR' },
  { date: '2026-07-18', group: 4, taskType: 'Main Hall' },
  { date: '2026-07-25', group: 5, taskType: 'CR' },
  { date: '2026-07-25', group: 6, taskType: 'Main Hall' },
  
  { date: '2026-08-01', group: 1, taskType: 'Main Hall' },
  { date: '2026-08-01', group: 2, taskType: 'CR' },
  { date: '2026-08-08', group: 3, taskType: 'Main Hall' },
  { date: '2026-08-08', group: 4, taskType: 'CR' },
  { date: '2026-08-15', group: 5, taskType: 'Main Hall' },
  { date: '2026-08-15', group: 6, taskType: 'CR' },
  { date: '2026-08-22', group: 1, taskType: 'CR' },
  { date: '2026-08-22', group: 2, taskType: 'Main Hall' },
  { date: '2026-08-29', group: 3, taskType: 'CR' },
  { date: '2026-08-29', group: 4, taskType: 'Main Hall' },
  
  { date: '2026-09-05', group: 5, taskType: 'CR' },
  { date: '2026-09-05', group: 6, taskType: 'Main Hall' },
  { date: '2026-09-12', group: 1, taskType: 'Main Hall' },
  { date: '2026-09-12', group: 2, taskType: 'CR' },
  { date: '2026-09-19', group: 3, taskType: 'Main Hall' },
  { date: '2026-09-19', group: 4, taskType: 'CR' },
  { date: '2026-09-26', group: 5, taskType: 'Main Hall' },
  { date: '2026-09-26', group: 6, taskType: 'CR' },
  
  { date: '2026-10-03', group: 1, taskType: 'CR' },
  { date: '2026-10-03', group: 2, taskType: 'Main Hall' },
  { date: '2026-10-10', group: 3, taskType: 'CR' },
  { date: '2026-10-10', group: 4, taskType: 'Main Hall' },
  { date: '2026-10-17', group: 5, taskType: 'CR' },
  { date: '2026-10-17', group: 6, taskType: 'Main Hall' },
  { date: '2026-10-24', group: 1, taskType: 'Main Hall' },
  { date: '2026-10-24', group: 2, taskType: 'CR' },
  { date: '2026-10-31', group: 3, taskType: 'Main Hall' },
  { date: '2026-10-31', group: 4, taskType: 'CR' },
  
  { date: '2026-11-07', group: 5, taskType: 'Main Hall' },
  { date: '2026-11-07', group: 6, taskType: 'CR' },
  { date: '2026-11-14', group: 1, taskType: 'CR' },
  { date: '2026-11-14', group: 2, taskType: 'Main Hall' },
  { date: '2026-11-21', group: 3, taskType: 'CR' },
  { date: '2026-11-21', group: 4, taskType: 'Main Hall' },
  { date: '2026-11-28', group: 5, taskType: 'CR' },
  { date: '2026-11-28', group: 6, taskType: 'Main Hall' },
  
  { date: '2026-12-05', group: 1, taskType: 'Main Hall' },
  { date: '2026-12-05', group: 2, taskType: 'CR' },
  { date: '2026-12-12', group: 3, taskType: 'Main Hall' },
  { date: '2026-12-12', group: 4, taskType: 'CR' },
  { date: '2026-12-19', group: 5, taskType: 'Main Hall' },
  { date: '2026-12-19', group: 6, taskType: 'CR' },
  { date: '2026-12-26', group: 1, taskType: 'CR' },
  { date: '2026-12-26', group: 2, taskType: 'Main Hall' },
]

export function getAssignmentsForGroup(group: number): CleaningAssignment[] {
  return cleaningSchedule2026
    .filter(assignment => assignment.group === group)
    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
}

export function getNextAssignment(group: number): CleaningAssignment | null {
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  
  const assignments = getAssignmentsForGroup(group)
  const upcoming = assignments.find(assignment => {
    const assignmentDate = new Date(assignment.date)
    assignmentDate.setHours(0, 0, 0, 0)
    return assignmentDate >= today
  })
  
  return upcoming || null
}

export function getDaysUntil(dateString: string): number {
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  const targetDate = new Date(dateString)
  targetDate.setHours(0, 0, 0, 0)
  
  const diffTime = targetDate.getTime() - today.getTime()
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))
  
  return diffDays
}

export function formatDate(dateString: string): string {
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

export function formatShortDate(dateString: string): string {
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  })
}

export function getDayOfWeek(dateString: string): string {
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', { weekday: 'short' })
}

export function generateICS(group: number): string {
  const assignments = getAssignmentsForGroup(group)
  
  const icsLines = [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'PRODID:-//Kingdom Hall CleanSync//NONSGML v1.0//EN',
    'CALSCALE:GREGORIAN',
    'METHOD:PUBLISH',
    'X-WR-CALNAME:Kingdom Hall Cleaning - Group ' + group,
    'X-WR-TIMEZONE:UTC',
  ]
  
  assignments.forEach(assignment => {
    const date = new Date(assignment.date)
    const dateStr = date.toISOString().split('T')[0].replace(/-/g, '')
    
    icsLines.push(
      'BEGIN:VEVENT',
      `DTSTART;VALUE=DATE:${dateStr}`,
      `DTEND;VALUE=DATE:${dateStr}`,
      `SUMMARY:Kingdom Hall Cleaning - ${assignment.taskType}`,
      `DESCRIPTION:Group ${group} cleaning assignment for ${assignment.taskType}`,
      `LOCATION:Kingdom Hall`,
      `UID:${assignment.date}-group${group}-${assignment.taskType.replace(' ', '')}@cleansync.local`,
      `DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z`,
      'STATUS:CONFIRMED',
      'SEQUENCE:0',
      'END:VEVENT'
    )
  })
  
  icsLines.push('END:VCALENDAR')
  
  return icsLines.join('\r\n')
}

export function downloadICS(group: number): void {
  const icsContent = generateICS(group)
  const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' })
  const link = document.createElement('a')
  link.href = URL.createObjectURL(blob)
  link.download = `kingdom-hall-cleaning-group-${group}-2026.ics`
  document.body.appendChild(link)
  link.click()
  document.body.removeChild(link)
  URL.revokeObjectURL(link.href)
}
